<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Quáº£n lÃ½ Email Online - Auto Filter</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <style>
    body { font-family: sans-serif; background: #f0f2f5; padding: 20px; text-align: center; }
    textarea, input, button { margin-top: 10px; padding: 10px; width: 90%; max-width: 400px; }
    button { cursor: pointer; }
    #copyButton { background: #28a745; color: white; font-size: 18px; }
    #deleteListButton { background: #dc3545; color: white; }
    #clearLogsButton { background: #ffc107; }
    #manualCopyButton { width: 60px; }
  </style>
</head>
<body>
  <h3>ğŸ“¨ Quáº£n lÃ½ danh sÃ¡ch Email Online</h3>

  <textarea id="emailListInput" placeholder="DÃ¡n email, phÃ¢n cÃ¡ch báº±ng dáº¥u cÃ¡ch, ; , | ..."></textarea>
  <button id="addListButton">â• ThÃªm Email VÃ o Danh SÃ¡ch</button>
  <button id="deleteListButton">ğŸ—‘ï¸ XÃ³a Danh SÃ¡ch Email</button>

  <div>
    <input type="text" id="emailOutput" placeholder="Email sáº½ hiá»‡n á»Ÿ Ä‘Ã¢y" readonly>
    <button id="manualCopyButton">ğŸ“‹</button>
  </div>

  <p id="count"></p>
  <button id="clearLogsButton">ğŸ§¹ Clear Log Copy</button>
  <br/>
  <button id="copyButton">ğŸ“‹ Láº¥y & Copy Email</button>

  <div id="customToast" style="margin-top:15px;color:red;font-weight:bold;"></div>

<script>
  // ğŸ‘‰ TODO: DÃ¡n firebaseConfig tháº­t cá»§a báº¡n vÃ o Ä‘Ã¢y
  const firebaseConfig = {
  apiKey: "AIzaSyD8qx-1A6yY9HZqAe6MoN8NkinQBpM6a8",
  authDomain: "webmail-app-f8158.firebaseapp.com",
  databaseURL: "https://webmail-app-f8158-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "webmail-app-f8158",
  storageBucket: "webmail-app-f8158.firebasestorage.app",
  messagingSenderId: "788366209485",
  appId: "1:788366209485:web:7497b706433add7d11d484"
};

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
  const emailRef = db.ref('emails');

  let emailList = [];

  function extractEmails(text) {
    const parts = text.split(/[\s,;|]+/);
    const regex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
    const unique = new Set();
    parts.forEach(p => { if (regex.test(p.trim())) unique.add(p.trim().toLowerCase()); });
    return Array.from(unique);
  }

  function updateCount() {
    document.getElementById('count').textContent = `ğŸ“Š Sá»‘ email cÃ²n láº¡i: ${emailList.length}`;
  }

  function showToast(msg) {
    document.getElementById('customToast').textContent = msg;
    setTimeout(() => { document.getElementById('customToast').textContent = ""; }, 3000);
  }

  function copyText(text) {
    navigator.clipboard.writeText(text).then(() => showToast("âœ… ÄÃ£ copy: " + text));
  }

  // Láº¯ng nghe thay Ä‘á»•i dá»¯ liá»‡u realtime
  emailRef.on('value', snap => {
    emailList = snap.val() || [];
    updateCount();
  });

  document.getElementById('addListButton').onclick = () => {
    const input = document.getElementById('emailListInput').value.trim();
    const emails = extractEmails(input);
    if (emails.length === 0) return showToast("âš ï¸ KhÃ´ng cÃ³ email há»£p lá»‡.");
    emailRef.transaction(current => {
      const updated = current ? current.slice() : [];
      emails.forEach(e => { if (!updated.includes(e)) updated.push(e); });
      return updated;
    }, (err, committed) => {
      if (err || !committed) showToast("âš ï¸ Lá»—i thÃªm email.");
      else showToast(`âœ… ÄÃ£ thÃªm ${emails.length} email.`);
      document.getElementById('emailListInput').value = '';
    });
  };

  document.getElementById('deleteListButton').onclick = () => {
    if (!confirm("Báº¡n cÃ³ cháº¯c muá»‘n xÃ³a danh sÃ¡ch?")) return;
    emailRef.set([], err => {
      if (err) showToast("âš ï¸ Lá»—i xÃ³a danh sÃ¡ch.");
      else showToast("âœ… ÄÃ£ xÃ³a toÃ n bá»™.");
    });
  };

  document.getElementById('manualCopyButton').onclick = () => {
    const email = document.getElementById('emailOutput').value;
    if (!email) return showToast("âš ï¸ KhÃ´ng cÃ³ email Ä‘á»ƒ copy.");
    copyText(email);
  };

  document.getElementById('copyButton').onclick = () => {
    if (emailList.length === 0) return showToast("âš ï¸ Háº¿t email.");
    const idx = Math.floor(Math.random() * emailList.length);
    const email = emailList[idx];
    document.getElementById('emailOutput').value = email;
    copyText(email);
    // XÃ³a email Ä‘Ã£ láº¥y
    emailRef.transaction(list => {
      if (!list) return [];
      const i = list.indexOf(email);
      if (i !== -1) list.splice(i, 1);
      return list;
    });
  };

  document.getElementById('clearLogsButton').onclick = () => {
    document.getElementById('emailOutput').value = "";
    showToast("âœ… ÄÃ£ clear log.");
  };
</script>
</body>
</html>
