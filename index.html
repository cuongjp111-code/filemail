<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Quản lý Email Online - Auto Filter</title>

  <!-- Firebase compat SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

  <style>
    body {
      font-family: sans-serif;
      background: #f0f2f5;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }
    textarea, input, button {
      font-size: 16px;
      width: 90%;
      max-width: 340px;
      margin-top: 10px;
      padding: 12px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    button {
      background: #007bff;
      color: white;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background: #0056b3;
    }
    #deleteListButton { background: #dc3545; }
    #deleteListButton:hover { background: #a71d2a; }
    #copyButton {
      background: #28a745;
      font-size: 18px;
      margin-top: 12px;
    }
    #copyButton:hover { background: #1c7c31; }
  </style>
</head>
<body>
  <h3>📨 Quản lý danh sách Email Online (Firebase)</h3>

  <textarea id="emailListInput" placeholder="Dán email, phân cách bởi , ; | hoặc xuống dòng"></textarea>
  <button id="addListButton">➕ Thêm Email</button>
  <button id="deleteListButton">🗑️ Xóa Danh Sách</button>

  <p id="count"></p>
  <input type="text" id="emailOutput" readonly placeholder="Email copy sẽ hiện ở đây">
  <button id="copyButton">📋 Lấy & Copy Email</button>

  <script>
    // 🔥 Firebase Config (bạn thay bằng config thật của project)
    const firebaseConfig = {
      apiKey: "AIzaSyD8gx-1A6pyY9HZqAe6MoN8NkinQBpM6a8",
      authDomain: "webmail-app-f8158.firebaseapp.com",
      databaseURL: "https://webmail-app-f8158-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "webmail-app-f8158",
      storageBucket: "webmail-app-f8158.appspot.com",
      messagingSenderId: "788366209485",
      appId: "1:788366209485:web:7497b706433add7d11d484"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const emailRef = db.ref("emails");

    let emailList = [];

    // Cập nhật số lượng
    function updateCount() {
      document.getElementById("count").textContent = `📊 Số email còn lại: ${emailList.length}`;
    }

    // Lấy dữ liệu realtime
    emailRef.on("value", snap => {
      emailList = snap.val() || [];
      updateCount();
    });

    // Thêm email
    document.getElementById("addListButton").addEventListener("click", () => {
      const input = document.getElementById("emailListInput").value;
      const parts = input.split(/[\s,;|]+/).map(e => e.trim()).filter(e => e.includes("@"));
      if (parts.length === 0) {
        alert("⚠️ Không có email hợp lệ!");
        return;
      }
      emailRef.transaction(current => {
        const arr = current || [];
        parts.forEach(e => { if (!arr.includes(e)) arr.push(e); });
        return arr;
      });
      document.getElementById("emailListInput").value = "";
    });

    // Xóa danh sách
    document.getElementById("deleteListButton").addEventListener("click", () => {
      if (confirm("Bạn có chắc muốn xóa toàn bộ danh sách?")) {
        emailRef.set([]);
      }
    });

    // Copy email ngẫu nhiên
    document.getElementById("copyButton").addEventListener("click", () => {
      if (emailList.length === 0) {
        alert("⚠️ Danh sách trống!");
        return;
      }
      const idx = Math.floor(Math.random() * emailList.length);
      const email = emailList[idx];
      document.getElementById("emailOutput").value = email;
      navigator.clipboard.writeText(email);
      // Xóa email đã lấy
      emailRef.transaction(current => {
        if (!current) return [];
        current.splice(idx, 1);
        return current;
      });
    });
  </script>
</body>
</html>
